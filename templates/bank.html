<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bank Balances</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; padding: 24px }
      table { border-collapse: collapse; width: 100%; max-width: 800px }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left }
      th { background: #f3f3f3 }
      .negative { color: #c00 }
      .positive { color: #0a0 }
    </style>
  </head>
  <body>
    <h1>Bank Balances</h1>
    <p>Shows username, balance, recent gain/loss and totals.</p>

    <table id="bank-table">
      <thead>
        <tr>
          <th>Username</th>
          <th>Balance</th>
          <th>Last Gain</th>
          <th>Last Loss</th>
          <th>Total Gained</th>
          <th>Total Lost</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="6">Loadingâ€¦</td></tr>
      </tbody>
    </table>

    <script>
      async function loadBanks() {
        const res = await fetch('/api/bank/all');
        const data = await res.json();
        const tbody = document.querySelector('#bank-table tbody');
        tbody.innerHTML = '';
        if (!Array.isArray(data) || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6">No users yet.</td></tr>';
          return;
        }
        for (const u of data) {
          const tr = document.createElement('tr');
          const balClass = (u.balance >= 0) ? 'positive' : 'negative';
          tr.innerHTML = `
            <td>${u.username}</td>
            <td class="${balClass}">${u.balance}</td>
            <td>${u.last_gain}</td>
            <td>${u.last_loss}</td>
            <td>${u.total_gained}</td>
            <td>${u.total_lost}</td>
          `;
          tbody.appendChild(tr);
        }
      }
      loadBanks();
      // Refresh every 5s
      setInterval(loadBanks, 5000);
    </script>
  </body>
</html>
